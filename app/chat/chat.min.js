(function(){var a=document.getElementsByTagName("script");var b=a[a.length-1].src;angular.module("acdesarrollos.chat",["ngRoute"]).controller("ChatController",c);c.$inject=["$scope","$location","ContactsService","FireModel","FireService"];function c(n,j,l,i,g){var f=new Firebase("https://chat-acdesarrollos.firebaseio.com/");var d=this;d.nombre="";d.email="";d.message="";d.chatIsLogged=false;d.enviando=false;d.idChat=0;d.loginChat=m;d.sendChat=k;d.chatRef=g.createArrayRef(i.refAcChats);f.on("child_added",function(o){var p=o.val();if(p.chat_type!=1&&p.id==d.idChat){var q=angular.element(document.querySelector("#message"));q.append('<div class="chat-ac"><img src="images/logo.png" width="40px" height="40px"><div><p>'+p.name+" ("+p.mail+") dice: "+p.message+'</p><div class="chat-hora">'+p.date_time+"</div></div></div>");if(!n.$$phase){n.$apply()}}});d.chatRef.$loaded(function(p){console.log(p.length);var o=angular.element(document.querySelector("#message"))},function(o){console.error("Error:",o)});function m(){if(d.nombre.trim()==""){return}if(d.email.trim()==""){return}if(d.enviando){return}d.enviando=true;d.idChat=Math.floor((Math.random()*1000)+1);l.sendMail(d.email,[{mail:"arielcessario@gmail.com"},{mail:"mmaneff@gmail.com"},{mail:"diegoyankelevich@gmail.com"}],d.nombre,"http://192.185.67.199/~arielces/ac-desarrollos-chat/","Nuevo chat de "+d.nombre,function(r,q){d.enviando=false});var o=Date.now();var p=h(o)+" "+e(o);d.chatRef.$add({id:d.idChat,name:d.nombre,mail:d.email,message:d.nombre+" se ha conectado",chat_type:1,date_time:p});d.chatIsLogged=true}function k(q){if(q.keyCode==13){if(d.nombre.trim()==""){return}if(d.email.trim()==""){return}if(d.message.trim()==""){return}var o=Date.now();var r=h(o)+" "+e(o);d.chatRef.$add({id:d.idChat,name:d.nombre,mail:d.email,message:d.message,chat_type:1,date_time:r});var p=angular.element(document.querySelector("#message"));p.append('<div class="chat-cliente"><img src="images/cliente.png" width="40px" height="40px"><div><p>'+d.nombre+" ("+d.email+") dice: "+d.message+'</p><div class="chat-hora">'+r+"</div></div></div>");if(!n.$$phase){n.$apply()}d.message=""}}function h(o){function p(r){return(r<10)?"0"+r:r}var q=new Date(o);return[p(q.getDate()),p(q.getMonth()+1),q.getFullYear()].join("/")}function e(o){function p(r){return(r<8)?"0"+r:r}var q=new Date(o);return[p(q.getHours()),p(q.getMinutes()+1),q.getSeconds()].join(":")}}})();